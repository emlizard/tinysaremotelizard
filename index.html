<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tinySA Ultra Ïõπ Ïª®Ìä∏Î°§Îü¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .status {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #f44336;
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: #4caf50;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .container {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 1rem;
            padding: 1rem;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 140px);
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section h3 {
            color: #64b5f6;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #e3f2fd;
        }

        input, select, button {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.3);
        }

        button {
            background: linear-gradient(45deg, #42a5f5, #1976d2);
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        button:hover {
            background: linear-gradient(45deg, #1976d2, #1565c0);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(25, 118, 210, 0.4);
        }

        button:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        button.test-button {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }

        button.test-button:hover {
            background: linear-gradient(45deg, #f57c00, #ef6c00);
        }

        .display-area {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .screen-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
        }

        .device-screen {
            background: #000;
            border: 3px solid #333;
            border-radius: 10px;
            margin: 0 auto;
            position: relative;
            cursor: crosshair;
            display: inline-block;
        }

        .device-screen canvas {
            display: block;
            border-radius: 7px;
        }

        .screen-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 1.2rem;
            border-radius: 7px;
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            min-height: 350px;
            position: relative;
        }

        .chart-container canvas {
            border-radius: 8px;
            background: #1a1a1a;
            width: 100%;
            max-width: 100%;
            height: auto;
        }

        .terminal {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            font-size: 0.8rem;
            border: 1px solid #333;
        }

        .terminal-line {
            margin-bottom: 0.25rem;
        }

        .measurements {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .measurement-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .measurement-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 0.5rem;
        }

        .measurement-label {
            font-size: 0.9rem;
            color: #e3f2fd;
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .controls button {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.8rem;
        }

        .debug-info {
            background: rgba(0, 100, 0, 0.1);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 0.5rem;
            margin-top: 1rem;
            font-size: 0.8rem;
            color: #00ff00;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .measurements {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì° tinySA Ultra Ïõπ Ïª®Ìä∏Î°§Îü¨</h1>
        <div class="status">
            <div class="status-dot" id="statusDot"></div>
            <span id="connectionStatus">Ïó∞Í≤∞ ÏïàÎê®</span>
            <select id="deviceType" style="width: auto; margin-left: 1rem;">
                <option value="tinysa-ultra">tinySA Ultra</option>
                <option value="tinysa">tinySA</option>
                <option value="nanovna">NanoVNA-H</option>
                <option value="nanovna-h4">NanoVNA-H4</option>
            </select>
        </div>
    </div>

    <div class="container">
        <!-- ÏôºÏ™Ω Ï†úÏñ¥ Ìå®ÎÑê -->
        <div class="panel">
            <!-- Ïó∞Í≤∞ ÏÉÅÌÉú -->
            <div class="section">
                <h3>üîå Ïû•ÎπÑ Ïó∞Í≤∞</h3>
                <button id="connectBtn">Ïû•ÎπÑ Ïó∞Í≤∞</button>
                <button id="disconnectBtn" disabled>Ïó∞Í≤∞ Ìï¥Ï†ú</button>
                <div style="margin-top: 1rem; font-size: 0.9rem; color: #ccc;">
                    <div>ÏÉÅÌÉú: <span id="deviceStatus">ÎåÄÍ∏∞ Ï§ë</span></div>
                    <div>FPS: <span id="fpsDisplay">0</span></div>
                    <div>Îç∞Ïù¥ÌÑ∞: <span id="dataCount">0</span> Ìè¨Ïù∏Ìä∏</div>
                </div>
            </div>

            <!-- Ï£ºÌååÏàò ÏÑ§Ï†ï -->
            <div class="section">
                <h3>üì° Ï£ºÌååÏàò ÏÑ§Ï†ï</h3>
                <div class="input-group">
                    <label>ÏãúÏûë Ï£ºÌååÏàò (MHz)</label>
                    <input type="number" id="startFreq" value="100" step="1" min="0.1" max="6000">
                </div>
                <div class="input-group">
                    <label>Ï¢ÖÎ£å Ï£ºÌååÏàò (MHz)</label>
                    <input type="number" id="stopFreq" value="1000" step="1" min="0.1" max="6000">
                </div>
                <div class="input-group">
                    <label>Ï∏°Ï†ï Ìè¨Ïù∏Ìä∏</label>
                    <select id="points">
                        <option value="101" selected>101</option>
                        <option value="201">201</option>
                        <option value="401">401</option>
                    </select>
                </div>
                <button id="setFreqBtn">Ï£ºÌååÏàò ÏÑ§Ï†ï Ï†ÅÏö©</button>
            </div>

            <!-- Ïä§Ï∫î Ï†úÏñ¥ -->
            <div class="section">
                <h3>üîç Ïä§Ï∫î Ï†úÏñ¥</h3>
                <button class="test-button" id="testDataBtn">üß™ ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±</button>
                <button id="scanBtn">Ïä§ÌéôÌä∏Îüº Ïä§Ï∫î</button>
                <button id="sweepBtn">S-parameter Ï∏°Ï†ï</button>
                <div class="controls">
                    <button id="pauseBtn" disabled>ÏùºÏãúÏ†ïÏßÄ</button>
                    <button id="resumeBtn" disabled>Ïû¨Í∞ú</button>
                </div>
            </div>

            <!-- Ï∫òÎ¶¨Î∏åÎ†àÏù¥ÏÖò -->
            <div class="section">
                <h3>üéØ Ï∫òÎ¶¨Î∏åÎ†àÏù¥ÏÖò</h3>
                <button id="calBtn">Ï∫òÎ¶¨Î∏åÎ†àÏù¥ÏÖò Ïã§Ìñâ</button>
                <div class="controls">
                    <button id="saveCalBtn">Ï†ÄÏû•</button>
                    <button id="loadCalBtn">Î°úÎìú</button>
                </div>
            </div>
        </div>

        <!-- Ï§ëÏïô ÎîîÏä§ÌîåÎ†àÏù¥ ÏòÅÏó≠ -->
        <div class="display-area">
            <!-- ÌôîÎ©¥ ÎØ∏Îü¨ÎßÅ -->
            <div class="screen-container">
                <h3 style="color: #64b5f6; margin-bottom: 1rem;">üì∫ Ïã§ÏãúÍ∞Ñ ÌôîÎ©¥</h3>
                <div class="device-screen" id="deviceScreen">
                    <canvas id="screenCanvas" width="480" height="320"></canvas>
                    <div class="screen-overlay" id="screenOverlay">
                        <div>üîå Ïû•ÎπÑÎ•º Ïó∞Í≤∞ÌïòÏÑ∏Ïöî</div>
                        <div style="font-size: 0.9rem; margin-top: 1rem; opacity: 0.7;">
                            ÎòêÎäî "ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±" ÌÅ¥Î¶≠
                        </div>
                    </div>
                </div>
                <div style="margin-top: 1rem; font-size: 0.9rem;">
                    ÌôîÎ©¥ÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ïû•ÎπÑ Ï°∞Ïûë | ÌÇ§Î≥¥Îìú: +/- Ï§å, S Ïä§ÌÅ¨Î¶∞ÏÉ∑
                </div>
            </div>

            <!-- Ïä§ÌéôÌä∏Îüº Ï∞®Ìä∏ -->
            <div class="chart-container">
                <h3 style="color: #64b5f6; margin-bottom: 1rem;">üìä Ïä§ÌéôÌä∏Îüº Î∂ÑÏÑù</h3>
                <canvas id="spectrumChart" width="800" height="250"></canvas>
                <div class="debug-info">
                    <div>ÏÉÅÌÉú: <span id="spectrumStatus">ÎåÄÍ∏∞ Ï§ë - ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî</span></div>
                    <div>Ï∫îÎ≤ÑÏä§: <span id="canvasInfo">-</span></div>
                    <div>Îç∞Ïù¥ÌÑ∞ Î≤îÏúÑ: <span id="dataRange">-</span></div>
                </div>
            </div>
        </div>

        <!-- Ïò§Î•∏Ï™Ω Ï†úÏñ¥ Ìå®ÎÑê -->
        <div class="panel">
            <!-- Ï∏°Ï†ïÍ∞í -->
            <div class="section">
                <h3>üìä Ï∏°Ï†ïÍ∞í</h3>
                <div class="measurements">
                    <div class="measurement-card">
                        <div class="measurement-value" id="peakFreq">-</div>
                        <div class="measurement-label">Peak Ï£ºÌååÏàò</div>
                    </div>
                    <div class="measurement-card">
                        <div class="measurement-value" id="peakPower">-</div>
                        <div class="measurement-label">Peak ÌååÏõå</div>
                    </div>
                    <div class="measurement-card">
                        <div class="measurement-value" id="s11Value">-</div>
                        <div class="measurement-label">S11 (dB)</div>
                    </div>
                    <div class="measurement-card">
                        <div class="measurement-value" id="vswr">-</div>
                        <div class="measurement-label">VSWR</div>
                    </div>
                </div>
            </div>

            <!-- Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• -->
            <div class="section">
                <h3>üíæ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h3>
                <button id="saveDataBtn">Ï∏°Ï†ï Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•</button>
                <button id="saveImageBtn">Ïä§ÌÅ¨Î¶∞ÏÉ∑ Ï†ÄÏû•</button>
                <button id="exportCsvBtn">CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
            </div>

            <!-- ÏãúÏä§ÌÖú Ï†úÏñ¥ -->
            <div class="section">
                <h3>‚öôÔ∏è ÏãúÏä§ÌÖú</h3>
                <button id="resetBtn">ÏãúÏä§ÌÖú Î¶¨ÏÖã</button>
                <button id="vbatBtn">Î∞∞ÌÑ∞Î¶¨ Ï≤¥ÌÅ¨</button>
                <button id="infoBtn">Ïû•ÎπÑ Ï†ïÎ≥¥</button>
            </div>

            <!-- Î™ÖÎ†πÏñ¥ -->
            <div class="section">
                <h3>üíª Î™ÖÎ†πÏñ¥</h3>
                <div class="input-group">
                    <input type="text" id="commandInput" placeholder="Î™ÖÎ†πÏñ¥ ÏûÖÎ†•..." value="help">
                </div>
                <button id="sendCommandBtn">Î™ÖÎ†π Ï†ÑÏÜ°</button>
            </div>

            <!-- ÌÜµÏã† Î°úÍ∑∏ -->
            <div class="section">
                <h3>üìü ÌÜµÏã† Î°úÍ∑∏</h3>
                <div class="terminal" id="terminal">
                    <div class="terminal-line">tinySA Ultra Ïõπ Ïª®Ìä∏Î°§Îü¨ v1.1</div>
                    <div class="terminal-line">Í∞úÏÑ†Îêú Î≤ÑÏ†ÑÏúºÎ°ú ÏãúÏûëÌï©ÎãàÎã§.</div>
                    <div class="terminal-line">üß™ ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï¥Î≥¥ÏÑ∏Ïöî!</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('=== Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎî© ÏãúÏûë ===');
        
        class TinySAController {
            constructor() {
                console.log('=== TinySAController ÏÉùÏÑ±Ïûê ÏãúÏûë ===');
                
                // Í∏∞Î≥∏ ÏÜçÏÑ±
                this.isConnected = false;
                this.serialPort = null;
                this.deviceType = 'tinysa-ultra';
                this.zoom = 1;
                this.isCapturing = false;
                this.isPaused = false;
                this.fps = 0;
                this.frameCount = 0;
                this.lastFpsUpdate = Date.now();
                
                // WebSerial ÏßÄÏõê ÌôïÏù∏
                this.simulationMode = !('serial' in navigator) || window.location.protocol !== 'https:';
                
                // Ï∏°Ï†ï Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
                this.spectrumData = {
                    frequencies: [],
                    powers: []
                };
                
                console.log('ÏãúÎÆ¨Î†àÏù¥ÏÖò Î™®Îìú:', this.simulationMode);
                
                // Ï¥àÍ∏∞Ìôî Í≥ºÏ†ï
                this.initializeElements();
                this.setupEventListeners();
                this.initializeCanvases();
                
                this.logToTerminal('‚úÖ Ïª®Ìä∏Î°§Îü¨ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                
                if (this.simulationMode) {
                    this.logToTerminal('üéÆ ÏãúÎÆ¨Î†àÏù¥ÏÖò Î™®Îìú ÌôúÏÑ±Ìôî');
                    this.logToTerminal('üí° "üß™ ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï¥ÏÑú Í∑∏ÎûòÌîÑÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî!');
                } else {
                    this.logToTerminal('üîó Ïã§Ï†ú Ïó∞Í≤∞ Î™®Îìú');
                }
                
                console.log('=== TinySAController Ï¥àÍ∏∞Ìôî ÏôÑÎ£å ===');
            }

            initializeElements() {
                console.log('DOM ÏöîÏÜå Ï¥àÍ∏∞Ìôî Ï§ë...');
                
                this.elements = {};
                const elementIds = [
                    'statusDot', 'connectionStatus', 'deviceType', 'deviceStatus', 'fpsDisplay', 'dataCount',
                    'connectBtn', 'disconnectBtn', 'startFreq', 'stopFreq', 'points', 'setFreqBtn',
                    'scanBtn', 'sweepBtn', 'pauseBtn', 'resumeBtn', 'testDataBtn',
                    'calBtn', 'saveCalBtn', 'loadCalBtn', 'deviceScreen', 'screenOverlay', 'screenCanvas',
                    'spectrumChart', 'spectrumStatus', 'canvasInfo', 'dataRange',
                    'peakFreq', 'peakPower', 's11Value', 'vswr',
                    'saveDataBtn', 'saveImageBtn', 'exportCsvBtn',
                    'resetBtn', 'vbatBtn', 'infoBtn',
                    'commandInput', 'sendCommandBtn', 'terminal'
                ];
                
                let foundElements = 0;
                let missingElements = [];
                
                elementIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        this.elements[id] = element;
                        foundElements++;
                    } else {
                        missingElements.push(id);
                        console.warn(`ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå: ${id}`);
                    }
                });
                
                console.log(`DOM ÏöîÏÜå Ï¥àÍ∏∞Ìôî ÏôÑÎ£å: ${foundElements}/${elementIds.length}Í∞ú Î∞úÍ≤¨`);
                if (missingElements.length > 0) {
                    console.warn('ÎàÑÎùΩÎêú ÏöîÏÜåÎì§:', missingElements);
                }
            }

            setupEventListeners() {
                console.log('Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï Ï§ë...');
                
                try {
                    // ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Î≤ÑÌäº (Í∞ÄÏû• Ï§ëÏöî!)
                    this.elements.testDataBtn?.addEventListener('click', () => {
                        console.log('üß™ ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                        this.generateTestData();
                    });

                    // Ïû•ÎπÑ ÌÉÄÏûÖ Î≥ÄÍ≤Ω
                    this.elements.deviceType?.addEventListener('change', (e) => {
                        this.deviceType = e.target.value;
                        this.updateDeviceConfig();
                    });

                    // Ïó∞Í≤∞ Ï†úÏñ¥
                    this.elements.connectBtn?.addEventListener('click', () => this.connect());
                    this.elements.disconnectBtn?.addEventListener('click', () => this.disconnect());

                    // Ï£ºÌååÏàò ÏÑ§Ï†ï
                    this.elements.setFreqBtn?.addEventListener('click', () => this.setFrequencies());

                    // Ïä§Ï∫î Ï†úÏñ¥
                    this.elements.scanBtn?.addEventListener('click', () => this.startScan());
                    this.elements.sweepBtn?.addEventListener('click', () => this.startSweep());
                    this.elements.pauseBtn?.addEventListener('click', () => this.pauseCapture());
                    this.elements.resumeBtn?.addEventListener('click', () => this.resumeCapture());

                    // Ï∫òÎ¶¨Î∏åÎ†àÏù¥ÏÖò
                    this.elements.calBtn?.addEventListener('click', () => this.calibrate());
                    this.elements.saveCalBtn?.addEventListener('click', () => this.saveCalibration());
                    this.elements.loadCalBtn?.addEventListener('click', () => this.loadCalibration());

                    // Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨
                    this.elements.saveDataBtn?.addEventListener('click', () => this.saveData());
                    this.elements.saveImageBtn?.addEventListener('click', () => this.saveImage());
                    this.elements.exportCsvBtn?.addEventListener('click', () => this.exportCsv());

                    // ÏãúÏä§ÌÖú Ï†úÏñ¥
                    this.elements.resetBtn?.addEventListener('click', () => this.systemReset());
                    this.elements.vbatBtn?.addEventListener('click', () => this.checkBattery());
                    this.elements.infoBtn?.addEventListener('click', () => this.getDeviceInfo());

                    // Î™ÖÎ†πÏñ¥
                    this.elements.sendCommandBtn?.addEventListener('click', () => this.sendCommand());
                    this.elements.commandInput?.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') this.sendCommand();
                    });

                    // ÌôîÎ©¥ ÌÅ¥Î¶≠
                    this.elements.screenCanvas?.addEventListener('click', (e) => this.handleScreenClick(e));

                    // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
                    document.addEventListener('keydown', (e) => {
                        switch (e.key) {
                            case '+':
                                this.zoom = Math.min(this.zoom + 0.2, 3);
                                this.updateScreenSize();
                                break;
                            case '-':
                                this.zoom = Math.max(this.zoom - 0.2, 0.5);
                                this.updateScreenSize();
                                break;
                            case 's':
                            case 'S':
                                if (e.ctrlKey) return;
                                e.preventDefault();
                                this.saveImage();
                                break;
                        }
                    });

                    console.log('‚úÖ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï ÏôÑÎ£å');
                } catch (error) {
                    console.error('‚ùå Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï Ïã§Ìå®:', error);
                }
            }

            initializeCanvases() {
                console.log('=== Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî ÏãúÏûë ===');
                
                try {
                    // ÌôîÎ©¥ ÎØ∏Îü¨ÎßÅ Ï∫îÎ≤ÑÏä§
                    if (this.elements.screenCanvas) {
                        this.screenCtx = this.elements.screenCanvas.getContext('2d');
                        console.log('‚úÖ ÌôîÎ©¥ Ï∫îÎ≤ÑÏä§ Ïª®ÌÖçÏä§Ìä∏ ÏÉùÏÑ± ÏôÑÎ£å');
                        this.updateDeviceConfig();
                    } else {
                        console.error('‚ùå screenCanvas ÏöîÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§!');
                    }

                    // Ïä§ÌéôÌä∏Îüº Ï∞®Ìä∏ Ï∫îÎ≤ÑÏä§
                    if (this.elements.spectrumChart) {
                        this.spectrumCtx = this.elements.spectrumChart.getContext('2d');
                        console.log('‚úÖ Ïä§ÌéôÌä∏Îüº Ï∫îÎ≤ÑÏä§ Ïª®ÌÖçÏä§Ìä∏ ÏÉùÏÑ± ÏôÑÎ£å');
                        console.log('Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞:', this.elements.spectrumChart.width, 'x', this.elements.spectrumChart.height);
                        
                        // Ï¥àÍ∏∞ ÏÉÅÌÉú ÌëúÏãú
                        this.drawEmptyChart();
                        this.updateCanvasInfo();
                    } else {
                        console.error('‚ùå spectrumChart ÏöîÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§!');
                    }

                    console.log('=== Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å ===');
                } catch (error) {
                    console.error('‚ùå Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                }
            }

            drawEmptyChart() {
                if (!this.spectrumCtx) return;
                
                const width = this.elements.spectrumChart.width;
                const height = this.elements.spectrumChart.height;
                
                // Î∞∞Í≤Ω
                this.spectrumCtx.fillStyle = '#1a1a1a';
                this.spectrumCtx.fillRect(0, 0, width, height);
                
                // Í≤©Ïûê
                this.spectrumCtx.strokeStyle = '#333';
                this.spectrumCtx.lineWidth = 1;
                
                for (let i = 0; i <= 10; i++) {
                    const x = (width * i) / 10;
                    this.spectrumCtx.beginPath();
                    this.spectrumCtx.moveTo(x, 0);
                    this.spectrumCtx.lineTo(x, height);
                    this.spectrumCtx.stroke();
                }
                
                for (let i = 0; i <= 8; i++) {
                    const y = (height * i) / 8;
                    this.spectrumCtx.beginPath();
                    this.spectrumCtx.moveTo(0, y);
                    this.spectrumCtx.lineTo(width, y);
                    this.spectrumCtx.stroke();
                }
                
                // ÏïàÎÇ¥ ÌÖçÏä§Ìä∏
                this.spectrumCtx.fillStyle = '#888';
                this.spectrumCtx.font = 'bold 16px Arial';
                this.spectrumCtx.textAlign = 'center';
                this.spectrumCtx.fillText('Ïä§ÌéôÌä∏Îüº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§', width / 2, height / 2 - 10);
                this.spectrumCtx.font = '14px Arial';
                this.spectrumCtx.fillText('"üß™ ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî', width / 2, height / 2 + 15);
            }

            updateCanvasInfo() {
                if (this.elements.canvasInfo && this.elements.spectrumChart) {
                    const canvas = this.elements.spectrumChart;
                    this.elements.canvasInfo.textContent = `${canvas.width}√ó${canvas.height}px`;
                }
            }

            generateTestData() {
                console.log('=== ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± ÏãúÏûë ===');
                this.logToTerminal('üß™ ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± ÏãúÏûë...');
                
                // Ïä§ÌéôÌä∏Îüº Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
                this.generateSimulatedSpectrum();
                
                // Ï∞®Ìä∏ Í∑∏Î¶¨Í∏∞
                this.drawSpectrumChart();
                
                // Ï∏°Ï†ïÍ∞í ÏóÖÎç∞Ïù¥Ìä∏
                this.updateMeasurements();
                
                this.logToTerminal('‚úÖ ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± ÏôÑÎ£å!');
                console.log('=== ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± ÏôÑÎ£å ===');
            }

            generateSimulatedSpectrum() {
                console.log('üìä Ïä§ÌéôÌä∏Îüº Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Ï§ë...');
                
                const startFreq = parseFloat(this.elements.startFreq?.value || 100) * 1e6;
                const stopFreq = parseFloat(this.elements.stopFreq?.value || 1000) * 1e6;
                const points = parseInt(this.elements.points?.value || 101);
                
                console.log(`ÏÑ§Ï†ï - ÏãúÏûë: ${startFreq/1e6}MHz, Ï¢ÖÎ£å: ${stopFreq/1e6}MHz, Ìè¨Ïù∏Ìä∏: ${points}`);
                
                // Îç∞Ïù¥ÌÑ∞ Î∞∞Ïó¥ Ï¥àÍ∏∞Ìôî
                this.spectrumData.frequencies = [];
                this.spectrumData.powers = [];
                
                for (let i = 0; i < points; i++) {
                    const freq = startFreq + (stopFreq - startFreq) * i / (points - 1);
                    
                    // ÌòÑÏã§Ï†ÅÏù∏ Ïä§ÌéôÌä∏Îüº ÏãúÎÆ¨Î†àÏù¥ÏÖò
                    let power = -80; // Í∏∞Î≥∏ ÎÖ∏Ïù¥Ï¶à ÌîåÎ°úÏñ¥
                    
                    // Ïó¨Îü¨ ÌîºÌÅ¨ ÏÉùÏÑ±
                    const freqNorm = (freq - startFreq) / (stopFreq - startFreq);
                    
                    // Ï≤´ Î≤àÏß∏ ÌîºÌÅ¨ (30% ÏßÄÏ†ê)
                    power += 25 * Math.exp(-Math.pow((freqNorm - 0.3) * 15, 2));
                    
                    // Îëê Î≤àÏß∏ ÌîºÌÅ¨ (70% ÏßÄÏ†ê)
                    power += 20 * Math.exp(-Math.pow((freqNorm - 0.7) * 12, 2));
                    
                    // ÏÑ∏ Î≤àÏß∏ ÏûëÏùÄ ÌîºÌÅ¨ (50% ÏßÄÏ†ê)
                    power += 10 * Math.exp(-Math.pow((freqNorm - 0.5) * 20, 2));
                    
                    // ÎûúÎç§ ÎÖ∏Ïù¥Ï¶à
                    power += (Math.random() - 0.5) * 6;
                    
                    this.spectrumData.frequencies.push(freq);
                    this.spectrumData.powers.push(power);
                }
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                if (this.elements.dataCount) {
                    this.elements.dataCount.textContent = this.spectrumData.powers.length.toString();
                }
                
                const minPower = Math.min(...this.spectrumData.powers);
                const maxPower = Math.max(...this.spectrumData.powers);
                
                if (this.elements.dataRange) {
                    this.elements.dataRange.textContent = `${minPower.toFixed(1)}~${maxPower.toFixed(1)}dBm`;
                }
                
                console.log(`‚úÖ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± ÏôÑÎ£å: ${points}Ìè¨Ïù∏Ìä∏, ${minPower.toFixed(1)}~${maxPower.toFixed(1)}dBm`);
                this.logToTerminal(`üìä Îç∞Ïù¥ÌÑ∞: ${points}Ìè¨Ïù∏Ìä∏, Î≤îÏúÑ: ${minPower.toFixed(1)}~${maxPower.toFixed(1)}dBm`);
            }

            drawSpectrumChart() {
                console.log('=== Ïä§ÌéôÌä∏Îüº Ï∞®Ìä∏ Í∑∏Î¶¨Í∏∞ ÏãúÏûë ===');
                
                if (!this.spectrumCtx) {
                    console.error('‚ùå Ïä§ÌéôÌä∏Îüº Ïª®ÌÖçÏä§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§!');
                    return;
                }
                
                if (this.spectrumData.powers.length === 0) {
                    console.warn('‚ö†Ô∏è Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ÏÑú Îπà Ï∞®Ìä∏Î•º Í∑∏Î¶ΩÎãàÎã§');
                    this.drawEmptyChart();
                    return;
                }
                
                const width = this.elements.spectrumChart.width;
                const height = this.elements.spectrumChart.height;
                
                console.log(`Ï∞®Ìä∏ ÌÅ¨Í∏∞: ${width}√ó${height}, Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏: ${this.spectrumData.powers.length}`);
                
                // Î∞∞Í≤Ω ÌÅ¥Î¶¨Ïñ¥ Î∞è Í∑∏Î¶¨Í∏∞
                this.spectrumCtx.clearRect(0, 0, width, height);
                this.spectrumCtx.fillStyle = '#1a1a1a';
                this.spectrumCtx.fillRect(0, 0, width, height);
                
                // Í≤©Ïûê Í∑∏Î¶¨Í∏∞
                this.drawGrid(width, height);
                
                // Îç∞Ïù¥ÌÑ∞ Î≤îÏúÑ Í≥ÑÏÇ∞
                const minPower = Math.min(...this.spectrumData.powers);
                const maxPower = Math.max(...this.spectrumData.powers);
                const powerRange = Math.max(maxPower - minPower, 5); // ÏµúÏÜå 5dB Î≤îÏúÑ
                
                console.log(`ÌååÏõå Î≤îÏúÑ: ${minPower.toFixed(1)} ~ ${maxPower.toFixed(1)} dBm (Î≤îÏúÑ: ${powerRange.toFixed(1)}dB)`);
                
                // Ïä§ÌéôÌä∏Îüº ÎùºÏù∏ Í∑∏Î¶¨Í∏∞
                this.spectrumCtx.strokeStyle = '#00ff00';
                this.spectrumCtx.lineWidth = 2;
                this.spectrumCtx.beginPath();
                
                let validPoints = 0;
                
                for (let i = 0; i < this.spectrumData.powers.length; i++) {
                    const x = (width * i) / Math.max(this.spectrumData.powers.length - 1, 1);
                    const normalizedPower = (this.spectrumData.powers[i] - minPower) / powerRange;
                    const y = height - (normalizedPower * height * 0.85) - height * 0.1; // 10% Ïó¨Î∞±
                    
                    if (i === 0) {
                        this.spectrumCtx.moveTo(x, y);
                    } else {
                        this.spectrumCtx.lineTo(x, y);
                    }
                    validPoints++;
                }
                
                this.spectrumCtx.stroke();
                console.log(`‚úÖ ${validPoints}Í∞ú Ìè¨Ïù∏Ìä∏Î°ú ÎùºÏù∏ Í∑∏Î¶¨Í∏∞ ÏôÑÎ£å`);
                
                // ÌîºÌÅ¨ ÎßàÏª§ Í∑∏Î¶¨Í∏∞
                this.drawPeakMarker(width, height, minPower, maxPower, powerRange);
                
                // Ï∂ï Î†àÏù¥Î∏î Í∑∏Î¶¨Í∏∞
                this.drawAxisLabels(width, height);
                
                // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                if (this.elements.spectrumStatus) {
                    this.elements.spectrumStatus.textContent = `${this.spectrumData.powers.length}Í∞ú Ìè¨Ïù∏Ìä∏ ÌëúÏãúÎê®`;
                }
                
                console.log('=== Ïä§ÌéôÌä∏Îüº Ï∞®Ìä∏ Í∑∏Î¶¨Í∏∞ ÏôÑÎ£å ===');
            }

            drawGrid(width, height) {
                this.spectrumCtx.strokeStyle = '#333';
                this.spectrumCtx.lineWidth = 1;
                
                // ÏàòÏßÅ Í≤©ÏûêÏÑ†
                for (let i = 0; i <= 10; i++) {
                    const x = (width * i) / 10;
                    this.spectrumCtx.beginPath();
                    this.spectrumCtx.moveTo(x, 0);
                    this.spectrumCtx.lineTo(x, height);
                    this.spectrumCtx.stroke();
                }
                
                // ÏàòÌèâ Í≤©ÏûêÏÑ†
                for (let i = 0; i <= 8; i++) {
                    const y = (height * i) / 8;
                    this.spectrumCtx.beginPath();
                    this.spectrumCtx.moveTo(0, y);
                    this.spectrumCtx.lineTo(width, y);
                    this.spectrumCtx.stroke();
                }
            }

            drawPeakMarker(width, height, minPower, maxPower, powerRange) {
                // ÌîºÌÅ¨ Ï∞æÍ∏∞
                const maxIndex = this.spectrumData.powers.indexOf(maxPower);
                const peakX = (width * maxIndex) / Math.max(this.spectrumData.powers.length - 1, 1);
                const peakY = height - ((maxPower - minPower) / powerRange * height * 0.85) - height * 0.1;
                
                // ÌîºÌÅ¨ ÎßàÏª§
                this.spectrumCtx.fillStyle = '#ff6600';
                this.spectrumCtx.beginPath();
                this.spectrumCtx.arc(peakX, peakY, 4, 0, 2 * Math.PI);
                this.spectrumCtx.fill();
                
                // ÌîºÌÅ¨ Î†àÏù¥Î∏î
                this.spectrumCtx.fillStyle = '#ffff00';
                this.spectrumCtx.font = '10px Arial';
                this.spectrumCtx.textAlign = 'center';
                this.spectrumCtx.fillText('PEAK', peakX, peakY - 8);
            }

            drawAxisLabels(width, height) {
                this.spectrumCtx.fillStyle = '#fff';
                this.spectrumCtx.font = '12px Arial';
                this.spectrumCtx.textAlign = 'right';
                this.spectrumCtx.fillText('Ï£ºÌååÏàò ‚Üí', width - 10, height - 10);
                
                this.spectrumCtx.textAlign = 'left';
                this.spectrumCtx.fillText('‚Üë', 5, 15);
                this.spectrumCtx.fillText('ÌååÏõå', 15, 15);
                this.spectrumCtx.fillText('(dBm)', 15, 30);
            }

            updateMeasurements() {
                console.log('üìä Ï∏°Ï†ïÍ∞í ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë...');
                
                if (this.spectrumData.powers.length > 0) {
                    const maxIndex = this.spectrumData.powers.indexOf(Math.max(...this.spectrumData.powers));
                    const peakFreq = this.spectrumData.frequencies[maxIndex];
                    const peakPower = this.spectrumData.powers[maxIndex];
                    
                    console.log(`Peak: ${(peakFreq/1e6).toFixed(3)} MHz, ${peakPower.toFixed(1)} dBm`);
                    
                    if (this.elements.peakFreq) {
                        this.elements.peakFreq.textContent = `${(peakFreq / 1e6).toFixed(3)} MHz`;
                    }
                    if (this.elements.peakPower) {
                        this.elements.peakPower.textContent = `${peakPower.toFixed(1)} dBm`;
                    }
                    if (this.elements.s11Value) {
                        this.elements.s11Value.textContent = `${(-12 + Math.random() * 8).toFixed(1)} dB`;
                    }
                    if (this.elements.vswr) {
                        this.elements.vswr.textContent = `${(1.1 + Math.random() * 0.4).toFixed(2)}`;
                    }
                    
                    console.log('‚úÖ Ï∏°Ï†ïÍ∞í ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                } else {
                    console.log('‚ö†Ô∏è Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ÏÑú Ï∏°Ï†ïÍ∞íÏùÑ "-"Î°ú ÏÑ§Ï†ï');
                    if (this.elements.peakFreq) this.elements.peakFreq.textContent = '-';
                    if (this.elements.peakPower) this.elements.peakPower.textContent = '-';
                    if (this.elements.s11Value) this.elements.s11Value.textContent = '-';
                    if (this.elements.vswr) this.elements.vswr.textContent = '-';
                }
            }

            // ===== ÎÇòÎ®∏ÏßÄ Î©îÏÑúÎìúÎì§ =====

            updateDeviceConfig() {
                const configs = {
                    'tinysa-ultra': { name: 'tinySA Ultra', width: 480, height: 320, maxFreq: 5300 },
                    'tinysa': { name: 'tinySA', width: 320, height: 240, maxFreq: 350 },
                    'nanovna': { name: 'NanoVNA-H', width: 320, height: 240, maxFreq: 900 },
                    'nanovna-h4': { name: 'NanoVNA-H4', width: 480, height: 320, maxFreq: 1500 }
                };

                const config = configs[this.deviceType];
                if (config && this.elements.screenCanvas) {
                    this.elements.screenCanvas.width = config.width;
                    this.elements.screenCanvas.height = config.height;
                    this.updateScreenSize();
                    
                    this.logToTerminal(`Ïû•ÎπÑ Î≥ÄÍ≤Ω: ${config.name} (${config.width}√ó${config.height})`);
                }
            }

            updateScreenSize() {
                if (this.elements.deviceScreen) {
                    this.elements.deviceScreen.style.transform = `scale(${this.zoom})`;
                }
            }

            async connect() {
                console.log('Ïó∞Í≤∞ ÏãúÏûë...');
                this.updateConnectionStatus('Ïó∞Í≤∞ Ï§ë...');
                this.logToTerminal('üîå Ïû•ÎπÑ Ïó∞Í≤∞ ÏãúÎèÑ Ï§ë...');

                setTimeout(() => {
                    this.isConnected = true;
                    this.updateConnectionStatus('ÏãúÎÆ¨Î†àÏù¥ÏÖò Ïó∞Í≤∞');
                    this.logToTerminal('‚úÖ ÏãúÎÆ¨Î†àÏù¥ÏÖò Î™®ÎìúÎ°ú Ïó∞Í≤∞Îê®');
                    this.startSimulation();
                }, 1000);
            }

            disconnect() {
                this.isCapturing = false;
                this.isConnected = false;
                this.updateConnectionStatus('Ïó∞Í≤∞ ÏïàÎê®');
                this.logToTerminal('üîå Ïó∞Í≤∞ Ìï¥Ï†úÎê®');
            }

            updateConnectionStatus(status) {
                if (this.elements.connectionStatus) {
                    this.elements.connectionStatus.textContent = status;
                }
                if (this.elements.deviceStatus) {
                    this.elements.deviceStatus.textContent = status;
                }
                if (this.elements.statusDot) {
                    this.elements.statusDot.classList.toggle('connected', this.isConnected);
                }
                if (this.elements.screenOverlay) {
                    this.elements.screenOverlay.style.display = this.isConnected ? 'none' : 'flex';
                }
                
                // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                if (this.elements.connectBtn) this.elements.connectBtn.disabled = this.isConnected;
                if (this.elements.disconnectBtn) this.elements.disconnectBtn.disabled = !this.isConnected;
            }

            startSimulation() {
                this.isCapturing = true;
                this.generateTestData(); // ÏûêÎèôÏúºÎ°ú ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            }

            setFrequencies() {
                const start = this.elements.startFreq?.value || 100;
                const stop = this.elements.stopFreq?.value || 1000;
                const points = this.elements.points?.value || 101;
                
                this.logToTerminal(`üì° Ï£ºÌååÏàò ÏÑ§Ï†ï: ${start}-${stop}MHz, ${points}Ìè¨Ïù∏Ìä∏`);
                
                // ÏÉà ÏÑ§Ï†ïÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ Ïû¨ÏÉùÏÑ±
                this.generateTestData();
            }

            startScan() {
                this.logToTerminal('üìä Ïä§ÌéôÌä∏Îüº Ïä§Ï∫î ÏãúÏûë...');
                this.generateTestData();
            }

            startSweep() {
                this.logToTerminal('üìà S-parameter Ï∏°Ï†ï ÏãúÏûë...');
                this.generateTestData();
            }

            pauseCapture() {
                this.isPaused = true;
                this.logToTerminal('‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ');
            }

            resumeCapture() {
                this.isPaused = false;
                this.logToTerminal('‚ñ∂Ô∏è Ïû¨Í∞ú');
            }

            calibrate() {
                this.logToTerminal('üéØ Ï∫òÎ¶¨Î∏åÎ†àÏù¥ÏÖò Ïã§Ìñâ...');
            }

            saveCalibration() {
                this.logToTerminal('üíæ Ï∫òÎ¶¨Î∏åÎ†àÏù¥ÏÖò Ï†ÄÏû•...');
            }

            loadCalibration() {
                this.logToTerminal('üìÇ Ï∫òÎ¶¨Î∏åÎ†àÏù¥ÏÖò Î°úÎìú...');
            }

            saveData() {
                this.logToTerminal('üíæ Ï∏°Ï†ï Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•...');
                const data = JSON.stringify(this.spectrumData, null, 2);
                this.downloadFile(data, 'spectrum_data.json', 'application/json');
            }

            saveImage() {
                this.logToTerminal('üì∏ Ïä§ÌÅ¨Î¶∞ÏÉ∑ Ï†ÄÏû•...');
                const canvas = this.elements.spectrumChart;
                if (canvas) {
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `spectrum_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.png`;
                        a.click();
                        URL.revokeObjectURL(url);
                    });
                }
            }

            exportCsv() {
                this.logToTerminal('üìä CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞...');
                let csv = 'Frequency(Hz),Power(dBm)\n';
                for (let i = 0; i < this.spectrumData.frequencies.length; i++) {
                    csv += `${this.spectrumData.frequencies[i]},${this.spectrumData.powers[i]}\n`;
                }
                this.downloadFile(csv, 'spectrum_data.csv', 'text/csv');
            }

            systemReset() {
                this.logToTerminal('üîÑ ÏãúÏä§ÌÖú Î¶¨ÏÖã...');
                this.spectrumData = { frequencies: [], powers: [] };
                this.drawEmptyChart();
                this.updateMeasurements();
            }

            checkBattery() {
                this.logToTerminal('üîã Î∞∞ÌÑ∞Î¶¨ Ï≤¥ÌÅ¨...');
                setTimeout(() => {
                    this.logToTerminal('üîã Î∞∞ÌÑ∞Î¶¨: 3.8V (85%)');
                }, 500);
            }

            getDeviceInfo() {
                this.logToTerminal('‚ÑπÔ∏è Ïû•ÎπÑ Ï†ïÎ≥¥ Ï°∞Ìöå...');
                setTimeout(() => {
                    this.logToTerminal('‚ÑπÔ∏è tinySA Ultra ÏãúÎÆ¨Î†àÏù¥ÌÑ∞ v1.1');
                    this.logToTerminal('‚ÑπÔ∏è Ï£ºÌååÏàò Î≤îÏúÑ: 100kHz - 5.3GHz');
                    this.logToTerminal('‚ÑπÔ∏è Ìï¥ÏÉÅÎèÑ: 1kHz');
                }, 500);
            }

            sendCommand() {
                const command = this.elements.commandInput?.value?.trim();
                if (command) {
                    this.logToTerminal(`üíª Î™ÖÎ†π: ${command}`);
                    this.elements.commandInput.value = '';
                    
                    setTimeout(() => {
                        switch (command.toLowerCase()) {
                            case 'help':
                                this.logToTerminal('üì• Î™ÖÎ†πÏñ¥: scan, sweep, cal, info, reset, test');
                                break;
                            case 'test':
                                this.generateTestData();
                                break;
                            case 'scan':
                                this.startScan();
                                break;
                            case 'reset':
                                this.systemReset();
                                break;
                            default:
                                this.logToTerminal(`üì• OK - "${command}" Ïã§ÌñâÎê®`);
                        }
                    }, 300);
                }
            }

            handleScreenClick(event) {
                if (!this.isConnected) return;
                
                const rect = this.elements.screenCanvas.getBoundingClientRect();
                const x = Math.floor((event.clientX - rect.left) * (this.elements.screenCanvas.width / rect.width));
                const y = Math.floor((event.clientY - rect.top) * (this.elements.screenCanvas.height / rect.height));
                
                this.logToTerminal(`üëÜ ÌÑ∞Ïπò: (${x}, ${y})`);
            }

            downloadFile(content, filename, contentType) {
                const blob = new Blob([content], { type: contentType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }

            logToTerminal(message) {
                console.log(message);
                
                if (this.elements.terminal) {
                    const timestamp = new Date().toLocaleTimeString();
                    const line = document.createElement('div');
                    line.className = 'terminal-line';
                    line.textContent = `[${timestamp}] ${message}`;
                    this.elements.terminal.appendChild(line);
                    this.elements.terminal.scrollTop = this.elements.terminal.scrollHeight;
                    
                    // Î°úÍ∑∏ ÎùºÏù∏ Ïàò Ï†úÌïú
                    const lines = this.elements.terminal.children;
                    if (lines.length > 50) {
                        lines[0].remove();
                    }
                }
            }
        }

        // Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏãúÏûë
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== DOM Î°úÎìú ÏôÑÎ£å ===');
            
            try {
                window.controller = new TinySAController();
                console.log('=== Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏãúÏûë ÏÑ±Í≥µ ===');
            } catch (error) {
                console.error('=== Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏãúÏûë Ïã§Ìå® ===', error);
            }
        });
    </script>
</body>
</html>
