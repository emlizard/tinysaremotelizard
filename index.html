<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tinySA Ultra ì›¹ ì»¨íŠ¸ë¡¤ëŸ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .status {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #f44336;
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: #4caf50;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .container {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 1rem;
            padding: 1rem;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 140px);
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section h3 {
            color: #64b5f6;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #e3f2fd;
        }

        input, select, button {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.3);
        }

        button {
            background: linear-gradient(45deg, #42a5f5, #1976d2);
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        button:hover {
            background: linear-gradient(45deg, #1976d2, #1565c0);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(25, 118, 210, 0.4);
        }

        button:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .display-area {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .screen-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
        }

        .device-screen {
            background: #000;
            border: 3px solid #333;
            border-radius: 10px;
            margin: 0 auto;
            position: relative;
            cursor: crosshair;
            display: inline-block;
        }

        .device-screen canvas {
            display: block;
            border-radius: 7px;
        }

        .screen-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 1.2rem;
            border-radius: 7px;
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            height: 350px;
            position: relative;
        }

        .chart-container canvas {
            border-radius: 8px;
            background: #1a1a1a;
            width: 100% !important;
            height: 250px !important;
        }

        .terminal {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            font-size: 0.8rem;
            border: 1px solid #333;
        }

        .terminal-line {
            margin-bottom: 0.25rem;
        }

        .measurements {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .measurement-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .measurement-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 0.5rem;
        }

        .measurement-label {
            font-size: 0.9rem;
            color: #e3f2fd;
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .controls button {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.8rem;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .measurements {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“¡ tinySA Ultra ì›¹ ì»¨íŠ¸ë¡¤ëŸ¬</h1>
        <div class="status">
            <div class="status-dot" id="statusDot"></div>
            <span id="connectionStatus">ì—°ê²° ì•ˆë¨</span>
            <select id="deviceType" style="width: auto; margin-left: 1rem;">
                <option value="tinysa-ultra">tinySA Ultra</option>
                <option value="tinysa">tinySA</option>
                <option value="nanovna">NanoVNA-H</option>
                <option value="nanovna-h4">NanoVNA-H4</option>
            </select>
        </div>
    </div>

    <div class="container">
        <!-- ì™¼ìª½ ì œì–´ íŒ¨ë„ -->
        <div class="panel">
            <!-- ì—°ê²° ìƒíƒœ -->
            <div class="section">
                <h3>ğŸ”Œ ì¥ë¹„ ì—°ê²°</h3>
                <button id="connectBtn">ì¥ë¹„ ì—°ê²°</button>
                <button id="disconnectBtn" disabled>ì—°ê²° í•´ì œ</button>
                <div style="margin-top: 1rem; font-size: 0.9rem; color: #ccc;">
                    <div>ìƒíƒœ: <span id="deviceStatus">ëŒ€ê¸° ì¤‘</span></div>
                    <div>FPS: <span id="fpsDisplay">0</span></div>
                    <div>ë°ì´í„°: <span id="dataCount">0</span> í¬ì¸íŠ¸</div>
                </div>
            </div>

            <!-- ì£¼íŒŒìˆ˜ ì„¤ì • -->
            <div class="section">
                <h3>ğŸ“¡ ì£¼íŒŒìˆ˜ ì„¤ì •</h3>
                <div class="input-group">
                    <label>ì‹œì‘ ì£¼íŒŒìˆ˜ (MHz)</label>
                    <input type="number" id="startFreq" value="0.1" step="0.1">
                </div>
                <div class="input-group">
                    <label>ì¢…ë£Œ ì£¼íŒŒìˆ˜ (MHz)</label>
                    <input type="number" id="stopFreq" value="350" step="0.1">
                </div>
                <div class="input-group">
                    <label>ì¸¡ì • í¬ì¸íŠ¸</label>
                    <select id="points">
                        <option value="101">101</option>
                        <option value="201">201</option>
                        <option value="401">401</option>
                    </select>
                </div>
                <button id="setFreqBtn">ì£¼íŒŒìˆ˜ ì„¤ì •</button>
            </div>

            <!-- ìŠ¤ìº” ì œì–´ -->
            <div class="section">
                <h3>ğŸ” ìŠ¤ìº” ì œì–´</h3>
                <button id="scanBtn">ìŠ¤í™íŠ¸ëŸ¼ ìŠ¤ìº”</button>
                <button id="sweepBtn">S-parameter ì¸¡ì •</button>
                <div class="controls">
                    <button id="pauseBtn" disabled>ì¼ì‹œì •ì§€</button>
                    <button id="resumeBtn" disabled>ì¬ê°œ</button>
                </div>
                <button id="testDataBtn">í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±</button>
            </div>

            <!-- ìº˜ë¦¬ë¸Œë ˆì´ì…˜ -->
            <div class="section">
                <h3>ğŸ¯ ìº˜ë¦¬ë¸Œë ˆì´ì…˜</h3>
                <button id="calBtn">ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì‹¤í–‰</button>
                <div class="controls">
                    <button id="saveCalBtn">ì €ì¥</button>
                    <button id="loadCalBtn">ë¡œë“œ</button>
                </div>
            </div>
        </div>

        <!-- ì¤‘ì•™ ë””ìŠ¤í”Œë ˆì´ ì˜ì—­ -->
        <div class="display-area">
            <!-- í™”ë©´ ë¯¸ëŸ¬ë§ -->
            <div class="screen-container">
                <h3 style="color: #64b5f6; margin-bottom: 1rem;">ğŸ“º ì‹¤ì‹œê°„ í™”ë©´</h3>
                <div class="device-screen" id="deviceScreen">
                    <canvas id="screenCanvas" width="480" height="320"></canvas>
                    <div class="screen-overlay" id="screenOverlay">
                        <div>ğŸ”Œ ì¥ë¹„ë¥¼ ì—°ê²°í•˜ì„¸ìš”</div>
                        <div style="font-size: 0.9rem; margin-top: 1rem; opacity: 0.7;">
                            í´ë¦­í•˜ì—¬ ì—°ê²°í•˜ê±°ë‚˜ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œë¡œ í…ŒìŠ¤íŠ¸
                        </div>
                    </div>
                </div>
                <div style="margin-top: 1rem; font-size: 0.9rem;">
                    í™”ë©´ì„ í´ë¦­í•˜ì—¬ ì¥ë¹„ ì¡°ì‘ | í‚¤ë³´ë“œ: +/- ì¤Œ, S ìŠ¤í¬ë¦°ìƒ·
                </div>
            </div>

            <!-- ìŠ¤í™íŠ¸ëŸ¼ ì°¨íŠ¸ -->
            <div class="chart-container">
                <h3 style="color: #64b5f6; margin-bottom: 1rem;">ğŸ“Š ìŠ¤í™íŠ¸ëŸ¼ ë¶„ì„</h3>
                <canvas id="spectrumChart" width="800" height="250"></canvas>
                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ccc;">
                    ìŠ¤í™íŠ¸ëŸ¼ ë°ì´í„°: <span id="spectrumStatus">ë°ì´í„° ì—†ìŒ</span>
                </div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ ì œì–´ íŒ¨ë„ -->
        <div class="panel">
            <!-- ì¸¡ì •ê°’ -->
            <div class="section">
                <h3>ğŸ“Š ì¸¡ì •ê°’</h3>
                <div class="measurements">
                    <div class="measurement-card">
                        <div class="measurement-value" id="peakFreq">-</div>
                        <div class="measurement-label">Peak ì£¼íŒŒìˆ˜</div>
                    </div>
                    <div class="measurement-card">
                        <div class="measurement-value" id="peakPower">-</div>
                        <div class="measurement-label">Peak íŒŒì›Œ</div>
                    </div>
                    <div class="measurement-card">
                        <div class="measurement-value" id="s11Value">-</div>
                        <div class="measurement-label">S11 (dB)</div>
                    </div>
                    <div class="measurement-card">
                        <div class="measurement-value" id="vswr">-</div>
                        <div class="measurement-label">VSWR</div>
                    </div>
                </div>
            </div>

            <!-- ë°ì´í„° ì €ì¥ -->
            <div class="section">
                <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
                <button id="saveDataBtn">ì¸¡ì • ë°ì´í„° ì €ì¥</button>
                <button id="saveImageBtn">ìŠ¤í¬ë¦°ìƒ· ì €ì¥</button>
                <button id="exportCsvBtn">CSV ë‚´ë³´ë‚´ê¸°</button>
            </div>

            <!-- ì‹œìŠ¤í…œ ì œì–´ -->
            <div class="section">
                <h3>âš™ï¸ ì‹œìŠ¤í…œ</h3>
                <button id="resetBtn">ì‹œìŠ¤í…œ ë¦¬ì…‹</button>
                <button id="vbatBtn">ë°°í„°ë¦¬ ì²´í¬</button>
                <button id="infoBtn">ì¥ë¹„ ì •ë³´</button>
            </div>

            <!-- ëª…ë ¹ì–´ -->
            <div class="section">
                <h3>ğŸ’» ëª…ë ¹ì–´</h3>
                <div class="input-group">
                    <input type="text" id="commandInput" placeholder="ëª…ë ¹ì–´ ì…ë ¥..." value="help">
                </div>
                <button id="sendCommandBtn">ëª…ë ¹ ì „ì†¡</button>
            </div>

            <!-- í†µì‹  ë¡œê·¸ -->
            <div class="section">
                <h3>ğŸ“Ÿ í†µì‹  ë¡œê·¸</h3>
                <div class="terminal" id="terminal">
                    <div class="terminal-line">tinySA Ultra ì›¹ ì»¨íŠ¸ë¡¤ëŸ¬ v1.1</div>
                    <div class="terminal-line">ê°œì„ ëœ ë²„ì „ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì‹œì‘...');
        
        class TinySAController {
            constructor() {
                console.log('TinySAController ìƒì„±ì ì‹œì‘');
                
                // ê¸°ë³¸ ì†ì„±
                this.isConnected = false;
                this.serialPort = null;
                this.deviceType = 'tinysa-ultra';
                this.zoom = 1;
                this.isCapturing = false;
                this.isPaused = false;
                this.fps = 0;
                this.frameCount = 0;
                this.lastFpsUpdate = Date.now();
                
                // WebSerial ì§€ì› í™•ì¸
                this.simulationMode = !('serial' in navigator) || window.location.protocol !== 'https:';
                
                // ì¸¡ì • ë°ì´í„° ì´ˆê¸°í™”
                this.spectrumData = {
                    frequencies: [],
                    powers: []
                };
                
                console.log('ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ:', this.simulationMode);
                
                // ì´ˆê¸°í™”
                this.initializeElements();
                this.setupEventListeners();
                this.initializeCanvases();
                this.logToTerminal('âœ… ì»¨íŠ¸ë¡¤ëŸ¬ ì´ˆê¸°í™” ì™„ë£Œ');
                
                if (this.simulationMode) {
                    this.logToTerminal('ğŸ® ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ - ëª¨ë“  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥');
                    this.logToTerminal('ğŸ’¡ "í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•´ë³´ì„¸ìš”');
                } else {
                    this.logToTerminal('ğŸ”— ì‹¤ì œ ì—°ê²° ëª¨ë“œ - ì¥ë¹„ ì—°ê²° ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”');
                }
            }

            initializeElements() {
                console.log('DOM ìš”ì†Œ ì´ˆê¸°í™” ì¤‘...');
                
                // í•„ìˆ˜ ìš”ì†Œë“¤
                this.elements = {
                    statusDot: document.getElementById('statusDot'),
                    connectionStatus: document.getElementById('connectionStatus'),
                    deviceType: document.getElementById('deviceType'),
                    deviceStatus: document.getElementById('deviceStatus'),
                    fpsDisplay: document.getElementById('fpsDisplay'),
                    dataCount: document.getElementById('dataCount'),
                    connectBtn: document.getElementById('connectBtn'),
                    disconnectBtn: document.getElementById('disconnectBtn'),
                    startFreq: document.getElementById('startFreq'),
                    stopFreq: document.getElementById('stopFreq'),
                    points: document.getElementById('points'),
                    setFreqBtn: document.getElementById('setFreqBtn'),
                    scanBtn: document.getElementById('scanBtn'),
                    sweepBtn: document.getElementById('sweepBtn'),
                    pauseBtn: document.getElementById('pauseBtn'),
                    resumeBtn: document.getElementById('resumeBtn'),
                    testDataBtn: document.getElementById('testDataBtn'),
                    calBtn: document.getElementById('calBtn'),
                    saveCalBtn: document.getElementById('saveCalBtn'),
                    loadCalBtn: document.getElementById('loadCalBtn'),
                    deviceScreen: document.getElementById('deviceScreen'),
                    screenOverlay: document.getElementById('screenOverlay'),
                    screenCanvas: document.getElementById('screenCanvas'),
                    spectrumChart: document.getElementById('spectrumChart'),
                    spectrumStatus: document.getElementById('spectrumStatus'),
                    peakFreq: document.getElementById('peakFreq'),
                    peakPower: document.getElementById('peakPower'),
                    s11Value: document.getElementById('s11Value'),
                    vswr: document.getElementById('vswr'),
                    saveDataBtn: document.getElementById('saveDataBtn'),
                    saveImageBtn: document.getElementById('saveImageBtn'),
                    exportCsvBtn: document.getElementById('exportCsvBtn'),
                    resetBtn: document.getElementById('resetBtn'),
                    vbatBtn: document.getElementById('vbatBtn'),
                    infoBtn: document.getElementById('infoBtn'),
                    commandInput: document.getElementById('commandInput'),
                    sendCommandBtn: document.getElementById('sendCommandBtn'),
                    terminal: document.getElementById('terminal')
                };
                
                // ëˆ„ë½ëœ ìš”ì†Œ í™•ì¸
                const missingElements = [];
                for (const [key, element] of Object.entries(this.elements)) {
                    if (!element) {
                        missingElements.push(key);
                    }
                }
                
                if (missingElements.length > 0) {
                    console.warn('ëˆ„ë½ëœ ìš”ì†Œë“¤:', missingElements);
                } else {
                    console.log('ëª¨ë“  DOM ìš”ì†Œ ì´ˆê¸°í™” ì™„ë£Œ');
                }
            }

            setupEventListeners() {
                console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘...');
                
                try {
                    // ì¥ë¹„ íƒ€ì… ë³€ê²½
                    this.elements.deviceType?.addEventListener('change', (e) => {
                        this.deviceType = e.target.value;
                        this.updateDeviceConfig();
                    });

                    // ì—°ê²° ì œì–´
                    this.elements.connectBtn?.addEventListener('click', () => this.connect());
                    this.elements.disconnectBtn?.addEventListener('click', () => this.disconnect());

                    // ì£¼íŒŒìˆ˜ ì„¤ì •
                    this.elements.setFreqBtn?.addEventListener('click', () => this.setFrequencies());

                    // ìŠ¤ìº” ì œì–´
                    this.elements.scanBtn?.addEventListener('click', () => this.startScan());
                    this.elements.sweepBtn?.addEventListener('click', () => this.startSweep());
                    this.elements.pauseBtn?.addEventListener('click', () => this.pauseCapture());
                    this.elements.resumeBtn?.addEventListener('click', () => this.resumeCapture());
                    this.elements.testDataBtn?.addEventListener('click', () => this.generateTestData());

                    // ìº˜ë¦¬ë¸Œë ˆì´ì…˜
                    this.elements.calBtn?.addEventListener('click', () => this.calibrate());
                    this.elements.saveCalBtn?.addEventListener('click', () => this.saveCalibration());
                    this.elements.loadCalBtn?.addEventListener('click', () => this.loadCalibration());

                    // ë°ì´í„° ê´€ë¦¬
                    this.elements.saveDataBtn?.addEventListener('click', () => this.saveData());
                    this.elements.saveImageBtn?.addEventListener('click', () => this.saveImage());
                    this.elements.exportCsvBtn?.addEventListener('click', () => this.exportCsv());

                    // ì‹œìŠ¤í…œ ì œì–´
                    this.elements.resetBtn?.addEventListener('click', () => this.systemReset());
                    this.elements.vbatBtn?.addEventListener('click', () => this.checkBattery());
                    this.elements.infoBtn?.addEventListener('click', () => this.getDeviceInfo());

                    // ëª…ë ¹ì–´
                    this.elements.sendCommandBtn?.addEventListener('click', () => this.sendCommand());
                    this.elements.commandInput?.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') this.sendCommand();
                    });

                    // í™”ë©´ í´ë¦­
                    this.elements.screenCanvas?.addEventListener('click', (e) => this.handleScreenClick(e));

                    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
                    document.addEventListener('keydown', (e) => {
                        switch (e.key) {
                            case '+':
                                this.zoom = Math.min(this.zoom + 0.2, 3);
                                this.updateScreenSize();
                                break;
                            case '-':
                                this.zoom = Math.max(this.zoom - 0.2, 0.5);
                                this.updateScreenSize();
                                break;
                            case 's':
                            case 'S':
                                if (e.ctrlKey) return;
                                e.preventDefault();
                                this.saveImage();
                                break;
                        }
                    });

                    console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
                } catch (error) {
                    console.error('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹¤íŒ¨:', error);
                }
            }

            initializeCanvases() {
                console.log('ìº”ë²„ìŠ¤ ì´ˆê¸°í™” ì¤‘...');
                
                try {
                    // í™”ë©´ ë¯¸ëŸ¬ë§ ìº”ë²„ìŠ¤
                    if (this.elements.screenCanvas) {
                        this.screenCtx = this.elements.screenCanvas.getContext('2d');
                        this.updateDeviceConfig();
                        console.log('í™”ë©´ ìº”ë²„ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ');
                    }

                    // ìŠ¤í™íŠ¸ëŸ¼ ì°¨íŠ¸ ìº”ë²„ìŠ¤
                    if (this.elements.spectrumChart) {
                        this.spectrumCtx = this.elements.spectrumChart.getContext('2d');
                        this.drawSpectrumChart();
                        console.log('ìŠ¤í™íŠ¸ëŸ¼ ìº”ë²„ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ');
                        console.log('ìº”ë²„ìŠ¤ í¬ê¸°:', this.elements.spectrumChart.width, 'x', this.elements.spectrumChart.height);
                    }

                    console.log('ìº”ë²„ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ');
                } catch (error) {
                    console.error('ìº”ë²„ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                }
            }

            updateDeviceConfig() {
                const configs = {
                    'tinysa-ultra': { name: 'tinySA Ultra', width: 480, height: 320, maxFreq: 5300 },
                    'tinysa': { name: 'tinySA', width: 320, height: 240, maxFreq: 350 },
                    'nanovna': { name: 'NanoVNA-H', width: 320, height: 240, maxFreq: 900 },
                    'nanovna-h4': { name: 'NanoVNA-H4', width: 480, height: 320, maxFreq: 1500 }
                };

                const config = configs[this.deviceType];
                if (config && this.elements.screenCanvas) {
                    this.elements.screenCanvas.width = config.width;
                    this.elements.screenCanvas.height = config.height;
                    this.updateScreenSize();
                    
                    // ì¢…ë£Œ ì£¼íŒŒìˆ˜ ì—…ë°ì´íŠ¸
                    if (this.elements.stopFreq) {
                        this.elements.stopFreq.value = config.maxFreq;
                    }
                    
                    this.logToTerminal(`ì¥ë¹„ ë³€ê²½: ${config.name} (${config.width}Ã—${config.height})`);
                }
            }

            updateScreenSize() {
                if (this.elements.deviceScreen) {
                    this.elements.deviceScreen.style.transform = `scale(${this.zoom})`;
                }
            }

            async connect() {
                console.log('ì—°ê²° ì‹œì‘...');
                
                if (this.elements.connectBtn) {
                    this.elements.connectBtn.disabled = true;
                }
                
                this.updateConnectionStatus('ì—°ê²° ì¤‘...');
                this.logToTerminal('ğŸ”Œ ì¥ë¹„ ì—°ê²° ì‹œë„ ì¤‘...');

                if (this.simulationMode) {
                    // ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ
                    setTimeout(() => {
                        this.isConnected = true;
                        this.updateConnectionStatus('ì‹œë®¬ë ˆì´ì…˜ ì—°ê²°');
                        this.logToTerminal('âœ… ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œë¡œ ì—°ê²°ë¨');
                        this.startSimulation();
                    }, 1000);
                } else {
                    // ì‹¤ì œ ì—°ê²°
                    try {
                        const config = this.getDeviceConfig();
                        
                        this.serialPort = await navigator.serial.requestPort({
                            filters: [{ usbVendorId: 0x0483, usbProductId: 0x5740 }]
                        });

                        await this.serialPort.open({
                            baudRate: 115200,
                            dataBits: 8,
                            stopBits: 1,
                            parity: 'none'
                        });

                        this.isConnected = true;
                        this.updateConnectionStatus('ì‹¤ì œ ì—°ê²°');
                        this.logToTerminal('âœ… ì‹¤ì œ ì¥ë¹„ ì—°ê²° ì„±ê³µ');
                        this.startRealCapture();
                        
                    } catch (error) {
                        this.logToTerminal(`âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
                        this.updateConnectionStatus('ì—°ê²° ì‹¤íŒ¨');
                        if (this.elements.connectBtn) {
                            this.elements.connectBtn.disabled = false;
                        }
                    }
                }
            }

            getDeviceConfig() {
                const configs = {
                    'tinysa-ultra': { name: 'tinySA Ultra', width: 480, height: 320 },
                    'tinysa': { name: 'tinySA', width: 320, height: 240 },
                    'nanovna': { name: 'NanoVNA-H', width: 320, height: 240 },
                    'nanovna-h4': { name: 'NanoVNA-H4', width: 480, height: 320 }
                };
                return configs[this.deviceType];
            }

            disconnect() {
                console.log('ì—°ê²° í•´ì œ...');
                
                this.isCapturing = false;
                this.isConnected = false;
                
                if (this.serialPort) {
                    this.serialPort.close().catch(console.error);
                    this.serialPort = null;
                }
                
                this.updateConnectionStatus('ì—°ê²° ì•ˆë¨');
                this.logToTerminal('ğŸ”Œ ì—°ê²° í•´ì œë¨');
                
                // í™”ë©´ ì´ˆê¸°í™”
                if (this.screenCtx) {
                    this.screenCtx.fillStyle = '#000';
                    this.screenCtx.fillRect(0, 0, this.elements.screenCanvas.width, this.elements.screenCanvas.height);
                }
            }

            updateConnectionStatus(status) {
                if (this.elements.connectionStatus) {
                    this.elements.connectionStatus.textContent = status;
                }
                
                if (this.elements.deviceStatus) {
                    this.elements.deviceStatus.textContent = status;
                }
                
                if (this.elements.statusDot) {
                    if (this.isConnected) {
                        this.elements.statusDot.classList.add('connected');
                    } else {
                        this.elements.statusDot.classList.remove('connected');
                    }
                }
                
                if (this.elements.screenOverlay) {
                    this.elements.screenOverlay.style.display = this.isConnected ? 'none' : 'flex';
                }
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                if (this.elements.connectBtn) {
                    this.elements.connectBtn.disabled = this.isConnected;
                }
                if (this.elements.disconnectBtn) {
                    this.elements.disconnectBtn.disabled = !this.isConnected;
                }
                if (this.elements.pauseBtn) {
                    this.elements.pauseBtn.disabled = !this.isConnected;
                }
                if (this.elements.resumeBtn) {
                    this.elements.resumeBtn.disabled = !this.isConnected;
                }
            }

            startSimulation() {
                console.log('ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...');
                
                this.isCapturing = true;
                
                const simulate = () => {
                    if (!this.isCapturing || !this.isConnected) return;
                    
                    if (!this.isPaused) {
                        this.generateSimulatedScreen();
                        this.updateFPS();
                    }
                    
                    setTimeout(simulate, 100); // 10 FPS
                };
                
                simulate();
                
                // ì´ˆê¸° í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
                this.generateTestData();
            }

            generateTestData() {
                console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹œì‘...');
                this.logToTerminal('ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì¤‘...');
                
                // ì‹œë®¬ë ˆì´ì…˜ ìŠ¤í™íŠ¸ëŸ¼ ë°ì´í„° ìƒì„±
                this.generateSimulatedSpectrum();
                
                // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
                this.drawSpectrumChart();
                
                // ì¸¡ì •ê°’ ì—…ë°ì´íŠ¸
                this.updateMeasurements();
                
                this.logToTerminal('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ');
            }

            generateSimulatedScreen() {
                if (!this.screenCtx) return;
                
                const width = this.elements.screenCanvas.width;
                const height = this.elements.screenCanvas.height;
                
                // ë°°ê²½
                this.screenCtx.fillStyle = '#000';
                this.screenCtx.fillRect(0, 0, width, height);
                
                // ê²©ì
                this.screenCtx.strokeStyle = '#333';
                this.screenCtx.lineWidth = 1;
                
                for (let i = 0; i <= 10; i++) {
                    const x = (width * i) / 10;
                    this.screenCtx.beginPath();
                    this.screenCtx.moveTo(x, 0);
                    this.screenCtx.lineTo(x, height);
                    this.screenCtx.stroke();
                }
                
                for (let i = 0; i <= 8; i++) {
                    const y = (height * i) / 8;
                    this.screenCtx.beginPath();
                    this.screenCtx.moveTo(0, y);
                    this.screenCtx.lineTo(width, y);
                    this.screenCtx.stroke();
                }
                
                // ì‹œë®¬ë ˆì´ì…˜ ìŠ¤í™íŠ¸ëŸ¼
                this.screenCtx.strokeStyle = '#0f0';
                this.screenCtx.lineWidth = 2;
                this.screenCtx.beginPath();
                
                const time = Date.now() / 1000;
                for (let x = 0; x < width; x++) {
                    const freq = x / width;
                    const y = height * 0.8 - 
                        Math.sin(freq * Math.PI * 4 + time) * 30 -
                        Math.sin(freq * Math.PI * 8 + time * 2) * 15 -
                        Math.random() * 5;
                    
                    if (x === 0) {
                        this.screenCtx.moveTo(x, y);
                    } else {
                        this.screenCtx.lineTo(x, y);
                    }
                }
                this.screenCtx.stroke();
                
                // í…ìŠ¤íŠ¸ ì •ë³´
                this.screenCtx.fillStyle = '#fff';
                this.screenCtx.font = '12px Arial';
                this.screenCtx.fillText(`${this.getDeviceConfig().name} - ì‹œë®¬ë ˆì´ì…˜`, 10, 20);
                this.screenCtx.fillText('100kHz - 350MHz', 10, height - 15);
            }

            generateSimulatedSpectrum() {
                console.log('ğŸ“Š ìŠ¤í™íŠ¸ëŸ¼ ë°ì´í„° ìƒì„± ì‹œì‘...');
                
                const startFreq = parseFloat(this.elements.startFreq?.value || 0.1) * 1e6;
                const stopFreq = parseFloat(this.elements.stopFreq?.value || 350) * 1e6;
                const points = parseInt(this.elements.points?.value || 101);
                
                console.log(`ì£¼íŒŒìˆ˜ ë²”ìœ„: ${startFreq/1e6} - ${stopFreq/1e6} MHz, í¬ì¸íŠ¸: ${points}`);
                
                // ë°ì´í„° ë°°ì—´ ì´ˆê¸°í™”
                this.spectrumData.frequencies = [];
                this.spectrumData.powers = [];
                
                for (let i = 0; i < points; i++) {
                    const freq = startFreq + (stopFreq - startFreq) * i / (points - 1);
                    
                    // ë” í˜„ì‹¤ì ì¸ ìŠ¤í™íŠ¸ëŸ¼ ì‹œë®¬ë ˆì´ì…˜
                    let power = -70; // ê¸°ë³¸ ë…¸ì´ì¦ˆ ë ˆë²¨
                    
                    // ëª‡ ê°œì˜ í”¼í¬ ì¶”ê°€
                    power += 20 * Math.exp(-Math.pow((freq - startFreq - (stopFreq - startFreq) * 0.3) / (stopFreq - startFreq) * 10, 2));
                    power += 15 * Math.exp(-Math.pow((freq - startFreq - (stopFreq - startFreq) * 0.7) / (stopFreq - startFreq) * 8, 2));
                    
                    // ëœë¤ ë…¸ì´ì¦ˆ ì¶”ê°€
                    power += (Math.random() - 0.5) * 8;
                    
                    this.spectrumData.frequencies.push(freq);
                    this.spectrumData.powers.push(power);
                }
                
                // ë°ì´í„° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                if (this.elements.dataCount) {
                    this.elements.dataCount.textContent = this.spectrumData.powers.length.toString();
                }
                
                console.log(`âœ… ìƒì„±ëœ ë°ì´í„° í¬ì¸íŠ¸: ${this.spectrumData.powers.length}`);
                console.log(`íŒŒì›Œ ë²”ìœ„: ${Math.min(...this.spectrumData.powers).toFixed(1)} ~ ${Math.max(...this.spectrumData.powers).toFixed(1)} dBm`);
                
                this.logToTerminal(`ğŸ“Š ìŠ¤í™íŠ¸ëŸ¼ ë°ì´í„° ìƒì„±: ${points}ê°œ í¬ì¸íŠ¸`);
            }

            drawSpectrumChart() {
                console.log('ğŸ“Š ìŠ¤í™íŠ¸ëŸ¼ ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì‹œì‘...');
                
                if (!this.spectrumCtx) {
                    console.error('âŒ ìŠ¤í™íŠ¸ëŸ¼ ìº”ë²„ìŠ¤ ì»¨í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }
                
                const width = this.elements.spectrumChart.width;
                const height = this.elements.spectrumChart.height;
                
                console.log(`ìº”ë²„ìŠ¤ í¬ê¸°: ${width} x ${height}`);
                
                // ë°°ê²½ í´ë¦¬ì–´
                this.spectrumCtx.clearRect(0, 0, width, height);
                
                // ë°°ê²½
                this.spectrumCtx.fillStyle = '#1a1a1a';
                this.spectrumCtx.fillRect(0, 0, width, height);
                
                // ê²©ì
                this.spectrumCtx.strokeStyle = '#444';
                this.spectrumCtx.lineWidth = 1;
                
                // ìˆ˜ì§ì„ 
                for (let i = 0; i <= 10; i++) {
                    const x = (width * i) / 10;
                    this.spectrumCtx.beginPath();
                    this.spectrumCtx.moveTo(x, 0);
                    this.spectrumCtx.lineTo(x, height);
                    this.spectrumCtx.stroke();
                }
                
                // ìˆ˜í‰ì„ 
                for (let i = 0; i <= 8; i++) {
                    const y = (height * i) / 8;
                    this.spectrumCtx.beginPath();
                    this.spectrumCtx.moveTo(0, y);
                    this.spectrumCtx.lineTo(width, y);
                    this.spectrumCtx.stroke();
                }
                
                console.log(`ë°ì´í„° í¬ì¸íŠ¸ ìˆ˜: ${this.spectrumData.powers.length}`);
                
                // ìŠ¤í™íŠ¸ëŸ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                if (this.elements.spectrumStatus) {
                    if (this.spectrumData.powers.length > 0) {
                        this.elements.spectrumStatus.textContent = `${this.spectrumData.powers.length}ê°œ í¬ì¸íŠ¸`;
                    } else {
                        this.elements.spectrumStatus.textContent = 'ë°ì´í„° ì—†ìŒ';
                    }
                }
                
                // ìŠ¤í™íŠ¸ëŸ¼ ë°ì´í„° ê·¸ë¦¬ê¸°
                if (this.spectrumData.powers.length > 0) {
                    console.log('ğŸ“ˆ ìŠ¤í™íŠ¸ëŸ¼ ë°ì´í„° ê·¸ë¦¬ê¸° ì¤‘...');
                    
                    const minPower = Math.min(...this.spectrumData.powers);
                    const maxPower = Math.max(...this.spectrumData.powers);
                    const powerRange = Math.max(maxPower - minPower, 10); // ìµœì†Œ 10dB ë²”ìœ„ ë³´ì¥
                    
                    console.log(`íŒŒì›Œ ë²”ìœ„: ${minPower.toFixed(1)} ~ ${maxPower.toFixed(1)} dBm (ë²”ìœ„: ${powerRange.toFixed(1)})`);
                    
                    // ë©”ì¸ ìŠ¤í™íŠ¸ëŸ¼ ë¼ì¸
                    this.spectrumCtx.strokeStyle = '#00ff00';
                    this.spectrumCtx.lineWidth = 2;
                    this.spectrumCtx.beginPath();
                    
                    let pointsDrawn = 0;
                    for (let i = 0; i < this.spectrumData.powers.length; i++) {
                        const x = (width * i) / Math.max(this.spectrumData.powers.length - 1, 1);
                        const normalizedPower = (this.spectrumData.powers[i] - minPower) / powerRange;
                        const y = height - (normalizedPower * height * 0.9) - height * 0.05; // 5% ì—¬ë°±
                        
                        if (i === 0) {
                            this.spectrumCtx.moveTo(x, y);
                            console.log(`ì²« ë²ˆì§¸ í¬ì¸íŠ¸: (${x.toFixed(1)}, ${y.toFixed(1)}), power: ${this.spectrumData.powers[i].toFixed(1)}dBm`);
                        } else {
                            this.spectrumCtx.lineTo(x, y);
                        }
                        pointsDrawn++;
                    }
                    
                    this.spectrumCtx.stroke();
                    console.log(`âœ… ${pointsDrawn}ê°œ í¬ì¸íŠ¸ ê·¸ë¦¬ê¸° ì™„ë£Œ`);
                    
                    // í”¼í¬ ë§ˆì»¤
                    const maxIndex = this.spectrumData.powers.indexOf(maxPower);
                    const peakX = (width * maxIndex) / Math.max(this.spectrumData.powers.length - 1, 1);
                    const peakY = height - ((maxPower - minPower) / powerRange * height * 0.9) - height * 0.05;
                    
                    this.spectrumCtx.fillStyle = '#ff6600';
                    this.spectrumCtx.beginPath();
                    this.spectrumCtx.arc(peakX, peakY, 4, 0, 2 * Math.PI);
                    this.spectrumCtx.fill();
                    
                } else {
                    console.warn('âš ï¸ ìŠ¤í™íŠ¸ëŸ¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
                    
                    // ë°ì´í„°ê°€ ì—†ì„ ë•Œ í‘œì‹œ
                    this.spectrumCtx.fillStyle = '#ff6666';
                    this.spectrumCtx.font = '16px Arial';
                    this.spectrumCtx.textAlign = 'center';
                    this.spectrumCtx.fillText('ë°ì´í„° ì—†ìŒ - "í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±" í´ë¦­', width / 2, height / 2);
                }
                
                // ì¶• ë ˆì´ë¸”
                this.spectrumCtx.fillStyle = '#fff';
                this.spectrumCtx.font = '12px Arial';
                this.spectrumCtx.textAlign = 'left';
                this.spectrumCtx.fillText('ì£¼íŒŒìˆ˜ â†’', width - 80, height - 10);
                
                this.spectrumCtx.textAlign = 'left';
                this.spectrumCtx.fillText('â†‘', 5, 15);
                this.spectrumCtx.fillText('íŒŒì›Œ', 15, 15);
                this.spectrumCtx.fillText('(dBm)', 15, 30);
                
                console.log('âœ… ìŠ¤í™íŠ¸ëŸ¼ ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì™„ë£Œ');
            }

            updateMeasurements() {
                console.log('ğŸ“Š ì¸¡ì •ê°’ ì—…ë°ì´íŠ¸ ì¤‘...');
                
                if (this.spectrumData.powers.length > 0) {
                    const maxIndex = this.spectrumData.powers.indexOf(Math.max(...this.spectrumData.powers));
                    const peakFreq = this.spectrumData.frequencies[maxIndex];
                    const peakPower = this.spectrumData.powers[maxIndex];
                    
                    console.log(`Peak: ${(peakFreq/1e6).toFixed(3)} MHz, ${peakPower.toFixed(1)} dBm`);
                    
                    if (this.elements.peakFreq) {
                        this.elements.peakFreq.textContent = `${(peakFreq / 1e6).toFixed(3)} MHz`;
                    }
                    if (this.elements.peakPower) {
                        this.elements.peakPower.textContent = `${peakPower.toFixed(1)} dBm`;
                    }
                    if (this.elements.s11Value) {
                        this.elements.s11Value.textContent = `${(-15 + Math.random() * 10).toFixed(1)} dB`;
                    }
                    if (this.elements.vswr) {
                        this.elements.vswr.textContent = `${(1.1 + Math.random() * 0.5).toFixed(2)}`;
                    }
                    
                    console.log('âœ… ì¸¡ì •ê°’ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.log('âš ï¸ ë°ì´í„°ê°€ ì—†ì–´ì„œ ì¸¡ì •ê°’ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            }

            async startRealCapture() {
                console.log('ì‹¤ì œ í™”ë©´ ìº¡ì²˜ ì‹œì‘...');
                // ì‹¤ì œ ì¥ë¹„ ìº¡ì²˜ ë¡œì§ (ê°„ë‹¨ ë²„ì „)
                this.isCapturing = true;
                // ì‹¤ì œ êµ¬í˜„ ì‹œ ì—¬ê¸°ì— ìº¡ì²˜ ì½”ë“œ ì¶”ê°€
            }

            // ê¸°ë³¸ ê¸°ëŠ¥ë“¤
            setFrequencies() {
                const start = this.elements.startFreq?.value || 0.1;
                const stop = this.elements.stopFreq?.value || 350;
                const points = this.elements.points?.value || 101;
                
                this.logToTerminal(`ğŸ“¡ ì£¼íŒŒìˆ˜ ì„¤ì •: ${start} - ${stop} MHz, ${points} í¬ì¸íŠ¸`);
                
                // ìƒˆë¡œìš´ ì„¤ì •ìœ¼ë¡œ ë°ì´í„° ì¬ìƒì„±
                this.generateSimulatedSpectrum();
                this.drawSpectrumChart();
                this.updateMeasurements();
            }

            startScan() {
                this.logToTerminal('ğŸ“Š ìŠ¤í™íŠ¸ëŸ¼ ìŠ¤ìº” ì‹œì‘...');
                this.setFrequencies();
            }

            startSweep() {
                this.logToTerminal('ğŸ“ˆ S-parameter ì¸¡ì • ì‹œì‘...');
                this.setFrequencies();
            }

            pauseCapture() {
                this.isPaused = true;
                this.logToTerminal('â¸ï¸ ì¼ì‹œì •ì§€');
            }

            resumeCapture() {
                this.isPaused = false;
                this.logToTerminal('â–¶ï¸ ì¬ê°œ');
            }

            calibrate() {
                this.logToTerminal('ğŸ¯ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì‹¤í–‰...');
            }

            saveCalibration() {
                this.logToTerminal('ğŸ’¾ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì €ì¥...');
            }

            loadCalibration() {
                this.logToTerminal('ğŸ“‚ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ë¡œë“œ...');
            }

            saveData() {
                this.logToTerminal('ğŸ’¾ ì¸¡ì • ë°ì´í„° ì €ì¥...');
                const data = JSON.stringify(this.spectrumData, null, 2);
                this.downloadFile(data, 'spectrum_data.json', 'application/json');
            }

            saveImage() {
                this.logToTerminal('ğŸ“¸ ìŠ¤í¬ë¦°ìƒ· ì €ì¥...');
                const canvas = this.elements.screenCanvas;
                if (canvas) {
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `screenshot_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.png`;
                        a.click();
                        URL.revokeObjectURL(url);
                    });
                }
            }

            exportCsv() {
                this.logToTerminal('ğŸ“Š CSV ë‚´ë³´ë‚´ê¸°...');
                let csv = 'Frequency(Hz),Power(dBm)\n';
                for (let i = 0; i < this.spectrumData.frequencies.length; i++) {
                    csv += `${this.spectrumData.frequencies[i]},${this.spectrumData.powers[i]}\n`;
                }
                this.downloadFile(csv, 'spectrum_data.csv', 'text/csv');
            }

            systemReset() {
                this.logToTerminal('ğŸ”„ ì‹œìŠ¤í…œ ë¦¬ì…‹...');
                // ë°ì´í„° ì´ˆê¸°í™”
                this.spectrumData = { frequencies: [], powers: [] };
                this.drawSpectrumChart();
                this.updateMeasurements();
            }

            checkBattery() {
                this.logToTerminal('ğŸ”‹ ë°°í„°ë¦¬ ì²´í¬...');
                setTimeout(() => {
                    this.logToTerminal('ğŸ”‹ ë°°í„°ë¦¬: 3.7V (82%)');
                }, 500);
            }

            getDeviceInfo() {
                this.logToTerminal('â„¹ï¸ ì¥ë¹„ ì •ë³´ ì¡°íšŒ...');
                setTimeout(() => {
                    this.logToTerminal(`â„¹ï¸ ${this.getDeviceConfig().name} ì‹œë®¬ë ˆì´ì…˜ ë²„ì „ v1.1`);
                    this.logToTerminal(`â„¹ï¸ ì¸¡ì • ë²”ìœ„: 100kHz - ${this.getDeviceConfig().maxFreq}MHz`);
                }, 500);
            }

            sendCommand() {
                const command = this.elements.commandInput?.value?.trim();
                if (command) {
                    this.logToTerminal(`ğŸ’» ëª…ë ¹: ${command}`);
                    this.elements.commandInput.value = '';
                    
                    // ê°„ë‹¨í•œ ì‹œë®¬ë ˆì´ì…˜ ì‘ë‹µ
                    setTimeout(() => {
                        if (command.toLowerCase() === 'help') {
                            this.logToTerminal('ğŸ“¥ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´: scan, sweep, cal, info, reset');
                        } else {
                            this.logToTerminal(`ğŸ“¥ ì‘ë‹µ: OK - "${command}" ì‹¤í–‰ë¨`);
                        }
                    }, 300);
                }
            }

            handleScreenClick(event) {
                if (!this.isConnected) return;
                
                const rect = this.elements.screenCanvas.getBoundingClientRect();
                const x = Math.floor((event.clientX - rect.left) * (this.elements.screenCanvas.width / rect.width));
                const y = Math.floor((event.clientY - rect.top) * (this.elements.screenCanvas.height / rect.height));
                
                this.logToTerminal(`ğŸ‘† í„°ì¹˜: (${x}, ${y})`);
            }

            updateFPS() {
                this.frameCount++;
                const now = Date.now();
                
                if (now - this.lastFpsUpdate >= 1000) {
                    this.fps = this.frameCount;
                    this.frameCount = 0;
                    this.lastFpsUpdate = now;
                    
                    if (this.elements.fpsDisplay) {
                        this.elements.fpsDisplay.textContent = this.fps.toString();
                    }
                }
            }

            downloadFile(content, filename, contentType) {
                const blob = new Blob([content], { type: contentType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }

            logToTerminal(message) {
                console.log(message);
                
                if (this.elements.terminal) {
                    const timestamp = new Date().toLocaleTimeString();
                    const line = document.createElement('div');
                    line.className = 'terminal-line';
                    line.textContent = `[${timestamp}] ${message}`;
                    this.elements.terminal.appendChild(line);
                    this.elements.terminal.scrollTop = this.elements.terminal.scrollHeight;
                    
                    // ë¡œê·¸ ë¼ì¸ ìˆ˜ ì œí•œ
                    const lines = this.elements.terminal.children;
                    if (lines.length > 50) {
                        lines[0].remove();
                    }
                }
            }
        }

        // ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM ë¡œë“œ ì™„ë£Œ');
            
            try {
                window.controller = new TinySAController();
                console.log('âœ… ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì„±ê³µ');
            } catch (error) {
                console.error('âŒ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹¤íŒ¨:', error);
            }
        });
    </script>
</body>
</html>
